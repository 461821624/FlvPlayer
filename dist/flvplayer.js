/*!
 * FlvPlayer.js v1.1.4
 * Github: https://github.com/zhw2590582/FlvPlayer#readme
 * (c) 2017-2020 Harvey Zack
 * Released under the MIT License.
 */(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.FlvPlayer=t())})(this,function(){'use strict';var z=Math.min,W=Math.max,q=Math.floor;function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t){for(var r,n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(){try{if("object"===G(window.WebAssembly)&&"function"==typeof window.WebAssembly.instantiate){var e=new window.WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof window.WebAssembly.Module)return new window.WebAssembly.Instance(e)instanceof window.WebAssembly.Instance}return!1}catch(t){return!1}}function a(){return"function"==typeof window.Worker}function o(){return"function"==typeof window.fetch}function i(){return window.URL&&"function"==typeof window.URL.createObjectURL}function d(){return"function"==typeof window.ReadableStream&&"function"==typeof window.Response&&Object.prototype.hasOwnProperty.call(window.Response.prototype,"body")}function c(){return"function"==typeof window.Blob&&function(){try{return!!new window.Blob}catch(t){return!1}}()}function u(){return"function"==typeof window.ArrayBuffer}function s(){var e=new Audio().canPlayType("audio/aac;");return"probably"===e||"maybe"===e}function l(){return window.AudioContext||window.webkitAudioContext}function f(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl2","webgl","experimental-webgl","moz-webgl","webkit-3d"],r=!1,n=0;n<t.length;n+=1)try{if(r=e.getContext(t[n]),r&&"function"==typeof r.getParameter)return!0}catch(t){//
}return!1}return!1}function p(){return n()&&a()&&o()&&c()&&u()&&i()&&s()&&l()&&f()}function m(e,t){var r=e.options,n=r.container.style.cssText;r.container.classList.add("flvplayer-container"),r.container.innerHTML="\n        <div class=\"flvplayer-player\">\n            <canvas class=\"flvplayer-canvas\" width=\"".concat(r.width,"\" height=\"").concat(r.height,"\"></canvas>\n        </div>\n    "),e.on("destroy",function(){r.container.innerHTML="",r.container.style.cssText=n,r.container.classList.remove("flvplayer-container")}),Object.defineProperty(t,"$container",{value:r.container}),Object.defineProperty(t,"$player",{value:r.container.querySelector(".flvplayer-player")}),Object.defineProperty(t,"$canvas",{value:r.container.querySelector(".flvplayer-canvas")})}function g(){return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function y(){return /MicroMessenger/i.test(navigator.userAgent)}function b(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function h(e){function t(n){for(var a=new Uint8Array(n),o=0;o<n;o+=1)a[o]=e[r],r+=1;return t.index=r,a}var r=0;return t.index=0,t}function v(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0].constructor;return t.reduce(function(e,t){var r=new n((0|e.byteLength)+(0|t.byteLength));return r.set(e,0),r.set(t,0|e.byteLength),r},new n)}function k(){return performance&&"function"==typeof performance.now?performance.now():Date.now()}function S(e,t){function r(){for(var i=arguments.length,d=Array(i),c=0;c<i;c++)d[c]=arguments[c];return o?(n=d,void(a=this)):void(o=!0,e.apply(this,d),setTimeout(function(){o=!1,n&&(r.apply(a,n),n=null,a=null)},t))}var n,a,o=!1;return r}function x(e,t,r){return W(z(e,W(t,r)),z(t,r))}function P(e,t,r){return"object"===G(t)&&Object.keys(t).forEach(function(r){P(e,r,t[r])}),e.style[t]=r,e}function C(e,t){return new Promise(function(r,n){var a=document.createElement("script");a.type="text/javascript",a.onload=function(){window[t]?r(window[t]):n(new Error("Unable to find global variable '".concat(t,"' from '").concat(e,"'")))},a.onerror=function(){n(new Error("Resource loading failed '".concat(e,"'")))},a.src=e,document.head.appendChild(a)})}function w(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce(function(e,t){return Object.getOwnPropertyNames(t).forEach(function(r){if(!b(e,r))Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));else throw new Error("Target attribute name is duplicated: ".concat(r))}),e},e)}function A(e){var t=0,r=k();return function(n){t+=n;var a=k(),o=a-r;1e3<=o&&(e(1e3*(t/o)),r=a,t=0)}}function D(e,t){Object.defineProperty(t,"rect",{get:function(){return t.$container.getBoundingClientRect()}}),["bottom","height","left","right","top","width"].forEach(function(e){Object.defineProperty(t,e,{get:function(){return t.rect[e]}})}),Object.defineProperty(t,"currentTime",{get:function(){return e.decoder.currentTime},set:function(r){e.options.cache&&e.decoder.seeked(x(r,0,t.loaded))}}),Object.defineProperty(t,"streaming",{get:function(){return e.demuxer.streaming}}),Object.defineProperty(t,"demuxed",{get:function(){return e.demuxer.demuxed}}),Object.defineProperty(t,"videoDecoding",{get:function(){return e.decoder.video.decoding}}),Object.defineProperty(t,"audioDecoding",{get:function(){return e.decoder.audio.decoding}}),Object.defineProperty(t,"duration",{get:function(){try{return e.demuxer.scripMeta.amf2.metaData.duration||e.options.duration}catch(t){return e.options.duration}}}),Object.defineProperty(t,"frameRate",{get:function(){var t=Math.round,r=t(e.options.frameRate||30);try{return t(e.demuxer.scripMeta.amf2.metaData.framerate)||r}catch(e){return r}}}),Object.defineProperty(t,"frameDuration",{get:function(){return 0|1e3/t.frameRate}}),Object.defineProperty(t,"muted",{get:function(){return e.decoder.audio.muted},set:function(t){e.decoder.audio.muted=t}}),Object.defineProperty(t,"volume",{get:function(){try{return e.decoder.audio.volume}catch(e){return 0}},set:function(r){try{return e.decoder.audio.volume=x(r,0,1),t.volume}catch(e){return r}}}),Object.defineProperty(t,"loaded",{get:function(){return e.decoder.video.loaded}}),Object.defineProperty(t,"playing",{get:function(){return e.decoder.playing}}),Object.defineProperty(t,"ended",{get:function(){return e.decoder.ended}}),Object.defineProperty(t,"play",{value:function(){t.playing||e.decoder.play()}}),Object.defineProperty(t,"pause",{value:function(){e.decoder.pause()}}),Object.defineProperty(t,"toggle",{value:function(){t.playing?t.pause():t.play()}})}function T(e,t){var r=e.events.proxy;e.on("scripMeta",function(e){var r=e.amf2.metaData,n=r.width,a=r.height;n&&a&&(t.$canvas.width=n,t.$canvas.height=a)}),r(t.$canvas,"click",function(){t.toggle()})}function j(e,t,r){return W(z(e,W(t,r)),z(t,r))}function O(...e){const t=e[0].constructor;return e.reduce((e,r)=>{const n=new t((0|e.byteLength)+(0|r.byteLength));return n.set(e,0),n.set(r,0|e.byteLength),n},new t)}function L(e,t,r){let n;return function(...a){clearTimeout(n),n=setTimeout(function(){n=null,e.apply(r,a)},t)}}function _(e){return 66===e?"Baseline":77===e?"Main":88===e?"Extended":100===e?"High":110===e?"High10":122===e?"High422":244===e?"High444":"Unknown"}function E(e){return(e/10).toFixed(1)}function R(e){var t=e.AVCProfileIndication.toString(16),r=e.profile_compatibility.toString(16),n=e.AVCLevelIndication.toString(16);return"avc1.".concat(t).concat(r).concat(n)}function B(e){var t=e.audioObjectType,r=(t-1<<6).toString(16);return"mp4a.".concat(r,".").concat(t)}function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function M(e){for(var t,r=1;r<arguments.length;r++)t=null==arguments[r]?{}:arguments[r],r%2?F(t,!0).forEach(function(r){U(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):F(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I(e){for(var t,r=1;r<arguments.length;r++)t=null==arguments[r]?{}:arguments[r],r%2?V(t,!0).forEach(function(r){U(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}var U=e,H=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},N=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e},$="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,G=r(function(e){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(n){return e.exports="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?r=function(e){return t(e)}:r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},r(n)}e.exports=r}),Q=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},J=function(e,t){return t&&("object"===G(t)||"function"==typeof t)?t:Q(e)},X=r(function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(r)}e.exports=t}),Y=r(function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(r,n)}e.exports=t}),Z=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)},K=r(function(e){!function(n,r){e.exports=r()}($,function(){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e){return e.constructor?e.constructor.name:null}function d(n,r){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return l(n,r,t),s(n,r,t),function(c,a,i){var e=f(a),r=f(c);if("object"===e){if("object"!==r)throw new Error("[Type Error]: '".concat(i.join("."),"' require 'object' type, but got '").concat(r,"'"));Object.keys(a).forEach(function(o){var r=c[o],t=a[o],e=i.slice();e.push(o),l(r,t,e),s(r,t,e),d(r,t,e)})}if("array"===e){if("array"!==r)throw new Error("[Type Error]: '".concat(i.join("."),"' require 'array' type, but got '").concat(r,"'"));c.forEach(function(u,r){var t=c[r],e=a[r]||a[0],n=i.slice();n.push(r),l(t,e,n),s(t,e,n),d(t,e,n)})}}(n,r,t),n}function l(a,r,t){if("string"===f(r)){var e=f(a);if(-1<r.indexOf("|")?!r.split("|").map(function(e){return e.toLowerCase().trim()}).filter(Boolean).some(function(t){return e===t}):r.toLowerCase().trim()!==e)throw new Error("[Type Error]: '".concat(t.join("."),"' require '").concat(r,"' type, but got '").concat(e,"'"))}}function s(a,r,t){if("function"===f(r)){var e=r(a,f(a),t);if(!0!==e){var n=f(e);throw"string"===n?new Error(e):"error"===n?e:new Error("[Validator Error]: The scheme for '".concat(t.join("."),"' validator require return true, but got '").concat(e,"'"))}}}var o=Object.prototype.toString,f=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var r=a(e);if("boolean"===r)return"boolean";if("string"===r)return"string";if("number"===r)return"number";if("symbol"===r)return"symbol";if("function"===r)return function(e){return"GeneratorFunction"===t(e)}(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){return!!(e.constructor&&"function"==typeof e.constructor.isBuffer)&&e.constructor.isBuffer(e)}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(t(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array";}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(r=o.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator";}return r.slice(8,-1).toLowerCase().replace(/\s/g,"")};return d.kindOf=f,d})}),ee=/*#__PURE__*/function(){function e(){H(this,e)}return N(e,[{key:"on",value:function(t,r,n){var a=this.e||(this.e={});return(a[t]||(a[t]=[])).push({fn:r,ctx:n}),this}},{key:"once",value:function(e,t,r){function n(){a.off(e,n);for(var o=arguments.length,i=Array(o),d=0;d<o;d++)i[d]=arguments[d];t.apply(r,i)}var a=this;return n._=t,this.on(e,n,r)}},{key:"emit",value:function(e){for(var t=((this.e||(this.e={}))[e]||[]).slice(),r=arguments.length,n=Array(1<r?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];for(var o=0;o<t.length;o+=1)t[o].fn.apply(t[o].ctx,n);return this}},{key:"off",value:function(t,r){var n=this.e||(this.e={}),e=n[t],a=[];if(e&&r)for(var o=0,d=e.length;o<d;o+=1)e[o].fn!==r&&e[o].fn._!==r&&a.push(e[o]);return a.length?n[t]=a:delete n[t],this}}]),e}(),te=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},re=r(function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function r(){return e.exports=t()?r=Reflect.construct:r=function(e,t,r){var n=[null];n.push.apply(n,t);var a=Function.bind.apply(e,n),o=new a;return r&&Y(o,r.prototype),o},r.apply(null,arguments)}e.exports=r}),ne=r(function(e){function t(r){var n="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){function t(){return re(e,arguments,X(this).constructor)}if(null===e||!te(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof n){if(n.has(e))return n.get(e);n.set(e,t)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Y(t,e)},t(r)}e.exports=t}),ae=/*#__PURE__*/function(e){function t(e){var r;return H(this,t),r=J(this,X(t).call(this,e)),r.name="FlvPlayerError",r}return Z(t,e),t}(ne(Error)),oe=function e(t){H(this,e);var r=t.options.debug;this.log=function(e){if(r){for(var t,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];(t=console).log.apply(t,["FlvPlayer: [".concat(e,"]")].concat(a))}},this.warn=function(e){if(!e&&r){for(var t,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];(t=console).warn.apply(t,a)}},this.error=function(e,t){if(!e)throw new ae(t)}},ie=/*#__PURE__*/function(){function e(t){var r=this;H(this,e),this.destroys=[],this.proxy=this.proxy.bind(this),t.on("destroy",function(){r.destroy()})}return N(e,[{key:"proxy",value:function(e,t,r){var n=this,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(Array.isArray(t))return t.map(function(t){return n.proxy(e,t,r,a)});e.addEventListener(t,r,a);var o=function(){return e.removeEventListener(t,r,a)};return this.destroys.push(o),o}},{key:"destroy",value:function(){this.destroys.forEach(function(e){return e()})}}]),e}(),de=/*#__PURE__*/Object.freeze({isMobile:g,isWechat:y,hasOwnProperty:b,readBuffer:h,mergeBuffer:v,createWorker:function(e){return new Worker(URL.createObjectURL(new Blob([e],{type:"application/javascript"})))},secondToTime:function(e){var t=q(e/3600),r=q((e-3600*t)/60),n=q(e-3600*t-60*r);return(0<t?[t,r,n]:[r,n]).map(function(e){return 10>e?"0".concat(e):e+""}).join(":")},getNowTime:k,debounce:function(e,t,r){function n(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];clearTimeout(a),a=setTimeout(function(){a=null,e.apply(r,o)},t)}var a;return n.clearTimeout=function(){clearTimeout(a)},n},throttle:S,clamp:x,setStyle:P,getStyle:function(e,t){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=getComputedStyle(e,null).getPropertyValue(t);return r?parseFloat(n):n},loadScript:C,proxyPropertys:w,calculationRate:A}),ce=function e(t){H(this,e),m(t,this),D(t,this),T(t,this)};class ue{constructor(e={}){if(this.option=K({...ue.option,...e},ue.scheme),this.option.volume=j(this.option.volume,0,1),this.option.chunk=j(this.option.chunk,0,1/0),this.option.maxTimeDiff=j(this.option.maxTimeDiff,0,1/0),this.option.autoEndTime=j(this.option.autoEndTime,0,1/0),this.context=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.context.createGain(),this.gainNode.gain.value=this.option.volume,this.source=null,this.decoding=!1,this.playing=!1,this.loadLength=0,this.loadByteSize=0,this.audioDuration=0,this.pcmLength=0,this.timestamps=[],this.audiobuffers=[],this.timestampTmp=[],this.decodeErrorBuffer=new Uint8Array,this.decodeWaitingBuffer=new Uint8Array,this.autoEndDebounce=L(()=>{this.end()},this.option.autoEndTime),this.option.touchResume&&"suspended"===this.context.state&&"ontouchstart"in window){const e=()=>{this.context.resume(),this.volume=1,document.body.removeEventListener("touchstart",e,!1),document.body.removeEventListener("click",e,!1)};document.body.addEventListener("touchstart",e,!1),document.body.addEventListener("click",e,!1)}}static get option(){return{volume:.7,cache:!0,chunk:65536,maxTimeDiff:200,autoEnd:!0,autoEndTime:5e3,touchResume:!0,onNext:e=>e,onLoad:()=>null,onStop:()=>null,onPlay:()=>null,onEnd:()=>null,onDestroy:()=>null,onDecodeDone:()=>null,onDecodeError:()=>null,onVolumeChange:()=>null,onFreeMemory:()=>null}}static get scheme(){return{volume:"number",cache:"boolean",chunk:"number",maxTimeDiff:"number",autoEnd:"boolean",autoEndTime:"number",touchResume:"boolean",onNext:"function",onLoad:"function",onStop:"function",onPlay:"function",onEnd:"function",onDestroy:"function",onDecodeDone:"function",onDecodeError:"function",onVolumeChange:"function",onFreeMemory:"function"}}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=j(e,0,1),this.option.onVolumeChange(e)}destroy(){return this.stop(),this.context=null,this.gainNode=null,this.source=null,this.timestamps=[],this.audiobuffers=[],this.timestampTmp=[],this.decodeErrorBuffer=new Uint8Array,this.decodeWaitingBuffer=new Uint8Array,this.option.onDestroy(),this}load(e,t){if(this.decoding=!0,this.loadLength+=1,this.loadByteSize+=e.byteLength,this.option.onLoad(e,t),this.decodeWaitingBuffer.byteLength>=this.option.chunk){this.timestamps.push(this.timestampTmp[0]),this.timestampTmp=[];const{buffer:e}=O(this.decodeErrorBuffer,this.decodeWaitingBuffer);this.decodeWaitingBuffer=new Uint8Array,this.context.decodeAudioData(e,e=>{this.audioDuration+=e.duration,this.pcmLength+=e.length,this.audiobuffers.push(e),this.decodeErrorBuffer=new Uint8Array,this.option.onDecodeDone(e)},e=>{this.decodeErrorBuffer=O(this.decodeErrorBuffer,this.decodeWaitingBuffer),this.option.onDecodeError(e)})}else this.timestampTmp.push(t),this.decodeWaitingBuffer=O(this.decodeWaitingBuffer,e);return this.option.autoEnd&&this.autoEndDebounce(),this}end(){if(this.decodeWaitingBuffer.length){this.timestamps.push(this.timestampTmp[0]),this.timestampTmp=[];const{buffer:e}=this.decodeWaitingBuffer;this.decodeWaitingBuffer=new Uint8Array,this.decodeErrorBuffer=new Uint8Array,this.context.decodeAudioData(e,e=>{this.audioDuration+=e.duration,this.pcmLength+=e.length,this.audiobuffers.push(e),this.decoding=!1,this.option.onEnd()})}return this}findIndex(e){return this.timestamps.findIndex((t,r)=>{const n=this.audiobuffers[r];return n&&t+1e3*n.duration>=e})}play(e=0){this.source&&(this.source.onended=null,this.source.stop(),this.source=null),e+=1,this.playing=!0;const t=this.findIndex(e),r=this.timestamps[t],n=this.audiobuffers[t];if(void 0===r||void 0===n)return this.stop(t,r);const a=W(0,(e-r)/1e3);return this.source=this.context.createBufferSource(),this.source.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.source.buffer=n,this.option.onPlay(n,e,a),this.source.start(0,a),this.source.onended=()=>{const e=this.timestamps[t+1],n=this.audiobuffers[t+1];if(void 0!==e&&void 0!==n){const t=this.option.onNext(e),r=this.findIndex(t);!this.option.cache&&0<r&&(this.option.onFreeMemory({total:this.pcmLength,pcm:this.audiobuffers.reduce((e,t)=>(e+=t.length,e),0),index:r}),this.audiobuffers.splice(0,r),this.timestamps.splice(0,r)),this.play(t)}else this.stop(t,r)},this}stop(e,t){return this.playing=!1,this.source&&(this.source.onended=null,this.source.stop(),this.source=null),this.option.onStop(e,t),this}}var se=/*#__PURE__*/function(){function e(t,r){var n=this;H(this,e),this.flv=t,this.dida=new ue({volume:t.options.muted?0:t.options.volume,cache:t.options.cache,chunk:t.options.audioChunk,maxTimeDiff:t.options.maxTimeDiff,touchResume:t.options.touchResume,onNext:function(e){var n=Math.abs,a=1e3*r.currentTime,o=e-a;return t.debug.log("time-diff",o),n(o)>=t.options.maxTimeDiff&&(t.debug.log("time-sync",o),r.currentTime=e/1e3),e},onVolumeChange:function(e){t.emit("volumechange",e)},onFreeMemory:function(e){t.debug.log("free-audio-memory",e),t.emit("freeAudioMemory",e)}}),t.on("audioData",function(e,t){n.dida.load(e,t)}),t.on("destroy",function(){n.dida.destroy()})}return N(e,[{key:"play",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.dida.play(1e3*e)}},{key:"stop",value:function(){this.dida.stop()}},{key:"muted",get:function(){return 0===this.volume},set:function(e){this.volume=e?0:.7}},{key:"volume",get:function(){return this.dida.volume},set:function(e){this.dida.volume=e}},{key:"decoding",get:function(){return this.dida.decoding}},{key:"playing",get:function(){return this.dida.playing}}]),e}(),le=/*#__PURE__*/function(){function e(t){var r=this;H(this,e),this.flv=t,this.ended=!1,this.playing=!1,this.waiting=!1,this.animationFrameTimer=null,this.waitingTimer=null,this.currentTime=0,this.lastUpdateTime=0,this.video=new window.FlvplayerDecoder(t,this),this.audio=t.options.hasAudio?new se(t,this):{play:function(){return null},stop:function(){return null},playing:!0,decoding:!1},t.on("ready",function(){t.options.autoPlay?r.play():r.video.draw(0)}),t.on("destroy",function(){r.pause()}),t.on("timeupdate",function(e){!t.options.live&&e>=t.player.duration&&r.pause()});var n=!1;t.events.proxy(document,"visibilitychange",function(){document.hidden?(n=r.playing,r.pause()):n&&r.play()})}return N(e,[{key:"play",value:function(){this.lastUpdateTime=k(),this.video.play(this.currentTime),this.audio.play(this.currentTime),this.animationFrame(),this.flv.emit("play")}},{key:"animationFrame",value:function(){var e=this,t=this.flv,r=t.options,n=t.player,a=t.debug;this.animationFrameTimer=requestAnimationFrame(function(){if(e.video.playing&&e.audio.playing){e.ended=!1,e.playing=!0,e.waiting=!1;var t=k();e.currentTime+=(t-e.lastUpdateTime)/1e3,e.lastUpdateTime=t,e.flv.emit("timeupdate",e.currentTime)}else return n.streaming||e.video.decoding||e.audio.decoding?(e.ended=!1,e.playing=!0,e.waiting=!0,e.flv.emit("waiting",e.currentTime),void(e.waitingTimer=setTimeout(function(){a.log("play-retry",{streaming:n.streaming,playing:{video:e.video.playing,audio:e.audio.playing},decoding:{video:e.video.decoding,audio:e.audio.decoding}}),e.play()},r.live?3e3:1e3))):(e.ended=!0,e.playing=!1,e.waiting=!1,e.pause(),e.flv.emit("ended",e.currentTime),void(r.loop&&r.cache&&!r.live&&(e.currentTime=0,e.play(),e.flv.emit("loop"))));e.animationFrame()})}},{key:"pause",value:function(){cancelAnimationFrame(this.animationFrameTimer),clearTimeout(this.waitingTimer),this.animationFrameTimer=null,this.waitingTimer=null,this.video.stop(),this.audio.stop(),this.ended=!1,this.playing=!1,this.waiting=!1,this.flv.emit("pause")}},{key:"seeked",value:function(e){var t=this.flv,r=t.player,n=t.options;!n.cache||n.live||(cancelAnimationFrame(this.animationFrameTimer),clearTimeout(this.waitingTimer),this.animationFrameTimer=null,this.waitingTimer=null,this.currentTime=e,this.video.draw(q(e*r.frameRate)),this.playing&&this.play(),this.flv.emit("seeked",e))}}]),e}(),fe=function e(t){var r=this;H(this,e);var n=t.options,a=t.debug;this.header=null,this.streaming=!1,this.demuxed=!1,this.videoDataSize=0,this.audioDataSize=0,this.videoDataLength=0,this.audioDataLength=0,this.streamStartTime=0,this.streamEndTime=0,this.scripMeta=null,this.AudioSpecificConfig=null,this.AVCDecoderConfigurationRecord=null,this.demuxWorker=new Worker(URL.createObjectURL(new Blob(["\"use strict\";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||\"[object Arguments]\"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _typeof(a){return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&\"function\"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?\"symbol\":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError(\"Cannot call a class as a function\")}function _possibleConstructorReturn(a,b){return b&&(\"object\"===_typeof(b)||\"function\"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return a}function _inherits(a,b){if(\"function\"!=typeof b&&null!==b)throw new TypeError(\"Super expression must either be null or a function\");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _wrapNativeSuper(a){var b=\"function\"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(a){function c(){return _construct(a,arguments,_getPrototypeOf(this).constructor)}if(null===a||!_isNativeFunction(a))return a;if(\"function\"!=typeof a)throw new TypeError(\"Super expression must either be null or a function\");if(\"undefined\"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(c,a)},_wrapNativeSuper(a)}function isNativeReflectConstruct(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _construct(){return _construct=isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _isNativeFunction(a){return-1!==Function.toString.call(a).indexOf(\"[native code]\")}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FlvPlayerError=/*#__PURE__*/function(a){function b(a){var c;return _classCallCheck(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a)),c.name=\"FlvPlayerError\",c}return _inherits(b,a),b}(_wrapNativeSuper(Error)),debug={warn:function warn(a){if(!a){for(var b,c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];(b=console).warn.apply(b,d)}},error:function error(a,b){if(!a)throw new FlvPlayerError(b)}};function mergeBuffer(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d=b[0].constructor;return b.reduce(function(a,b){var c=new d((0|a.byteLength)+(0|b.byteLength));return c.set(a,0),c.set(b,0|a.byteLength),c},new d)}function readBufferSum(a){var b=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];return a.reduce(function(c,d,e){return c+(b?d:d-128)*Math.pow(256,a.length-e-1)},0)}function readString(a){var b;return(b=String.fromCharCode).call.apply(b,[String].concat(_toConsumableArray(a)))}function readBuffer(a){function b(d){for(var e=new Uint8Array(d),f=0;f<d;f+=1)e[f]=a[c],c+=1;return b.index=c,e}var c=0;return b.index=0,b}function readDouble(a){var c=new DataView(new ArrayBuffer(a.length));return a.forEach(function(a,b){c.setUint8(b,a)}),c.getFloat64(0)}function readBoolean(a){return 0!==a[0]}var index=0,header=null,uint8=new Uint8Array,scripMeta=null,AudioSpecificConfig=null,AVCDecoderConfigurationRecord=null,nalStart=new Uint8Array([0,0,0,1]);function readable(a){return uint8.length-index>=a}function read(a){for(var b=new Uint8Array(a),c=0;c<a;c+=1)b[c]=uint8[index],index+=1;return b}function demuxerScripTag(a){function b(a){var d=null;if(a!==void 0)switch(a){case 0:d=readDouble(c(8));break;case 1:d=readBoolean(c(1));break;case 2:{var l=readBufferSum(c(2));d=readString(c(l));break}case 3:{d=Object.create(null);for(var m=-1;9!==m;){var e=readBufferSum(c(2)),f=readString(c(e)),g=c(1)[0];f&&(d[f]=b(g)),m=g}break}case 5:d=null;break;case 6:d=void 0;break;case 7:d=\"Reference #\".concat(c.index),c(2);break;case 8:{d=Object.create(null);for(var n=-1;9!==n;){var h=readBufferSum(c(2)),j=readString(c(h)),k=c(1)[0];j&&(d[j]=b(k)),n=k}break}case 10:{var o=readBufferSum(c(4));d=[];for(var p,q=0;q<o;q+=1)p=c(1)[0],d.push(b(p));break}case 11:d=readDouble(c(2));break;case 12:{var i=readBufferSum(c(4));d=readString(c(i));break}default:debug.error(!1,\"AMF: Unknown metaData type: \".concat(a));}return d}var c=readBuffer(a.body),d=Object.create(null),e=Object.create(null);for(d.type=c(1)[0],debug.error(2===d.type,\"AMF: [amf1] type expect 2, but got \".concat(d.type)),d.size=readBufferSum(c(2)),d.string=readString(c(d.size)),e.type=c(1)[0],debug.error(8===e.type||3===e.type,\"AMF: [amf2] type expect 8 or 3, but got \".concat(e.type)),e.size=readBufferSum(c(4)),e.metaData=Object.create(null);c.index<a.body.length;){var f=readBufferSum(c(2)),g=readString(c(f)),h=c(1)[0];g&&(e.metaData[g]=b(h))}debug.warn(c.index===a.body.length,\"[AMF] Seems to be incompletely parsed\"),debug.warn(e.size===Object.keys(e.metaData).length,\"[AMF] [amf2] length does not match\"),scripMeta={amf1:d,amf2:e},postMessage({type:\"scripMeta\",data:scripMeta})}function demuxerVideoTag(a){debug.error(1<a.body.length,\"Invalid video packet\");var b={frameType:(240&a.body[0])>>4,codecID:15&a.body[0]};debug.error(7===b.codecID,\"[videoTrack] Unsupported codec in video frame: \".concat(b.codecID));var c=a.body.slice(1,5);debug.error(4<=c.length,\"[H264] Invalid AVC packet, missing AVCPacketType or/and CompositionTime\");var d=new DataView(c.buffer),e=d.getUint8(0),f=(16777215&d.getUint32(0))<<8>>8,g=f+a.timestamp,h=a.body.subarray(5);if(0===e){debug.warn(!AVCDecoderConfigurationRecord,\"[h264] Find another one AVCDecoderConfigurationRecord\"),debug.error(7<=h.length,\"[H264] AVCDecoderConfigurationRecord parse length is not enough\");var j=readBuffer(h),k={};k.configurationVersion=j(1)[0],debug.error(1===k.configurationVersion,\"[H264] Invalid configurationVersion: \".concat(k.configurationVersion)),k.AVCProfileIndication=j(1)[0],debug.error(0!==k.AVCProfileIndication,\"[H264] Invalid AVCProfileIndication: \".concat(k.AVCProfileIndication)),k.profile_compatibility=j(1)[0],k.AVCLevelIndication=j(1)[0],k.lengthSizeMinusOne=(3&j(1)[0])+1,debug.error(4===k.lengthSizeMinusOne||3!==k.lengthSizeMinusOne,\"[H264] Invalid lengthSizeMinusOne: \".concat(k.lengthSizeMinusOne)),k.numOfSequenceParameterSets=31&j(1)[0],debug.error(0!==k.numOfSequenceParameterSets,\"[H264] Invalid numOfSequenceParameterSets: \".concat(k.numOfSequenceParameterSets)),debug.warn(1===k.numOfSequenceParameterSets,\"[H264] Strange numOfSequenceParameterSets: \".concat(k.numOfSequenceParameterSets));for(var p=0;p<k.numOfSequenceParameterSets;p+=1)if(k.sequenceParameterSetLength=readBufferSum(j(2)),0<k.sequenceParameterSetLength){var i=j(k.sequenceParameterSetLength);postMessage({type:\"videoData\",data:mergeBuffer(nalStart,i)})}k.numOfPictureParameterSets=j(1)[0],debug.error(0!==k.numOfPictureParameterSets,\"[H264] Invalid numOfPictureParameterSets: \".concat(k.numOfPictureParameterSets)),debug.warn(1===k.numOfPictureParameterSets,\"[H264] Strange numOfPictureParameterSets: \".concat(k.numOfPictureParameterSets));for(var q=0;q<k.numOfPictureParameterSets;q+=1)if(k.pictureParameterSetLength=readBufferSum(j(2)),0<k.pictureParameterSetLength){var r=j(k.pictureParameterSetLength);postMessage({type:\"videoData\",data:mergeBuffer(nalStart,r)})}AVCDecoderConfigurationRecord=k,postMessage({type:\"AVCDecoderConfigurationRecord\",data:k})}else if(1===e)for(var l,m=AVCDecoderConfigurationRecord,n=m.lengthSizeMinusOne,o=readBuffer(h);o.index<h.length;)l=readBufferSum(o(n)),postMessage({type:\"videoData\",data:mergeBuffer(nalStart,o(l)),timestamp:g});else debug.error(2===e,\"[H264] Invalid video packet type \".concat(e))}function demuxerAudioTag(a){debug.error(1<a.body.length,\"Invalid audio packet\");var b={soundFormat:(240&a.body[0])>>4,soundRate:(12&a.body[0])>>2,soundSize:(2&a.body[0])>>1,soundType:(1&a.body[0])>>0};debug.error(10===b.soundFormat,\"[audioTrack] unsupported audio format: \".concat(b.soundFormat));var c=a.body.subarray(1),d=c[0];if(0===d){var k=c.subarray(1);debug.warn(!AudioSpecificConfig,\"[AAC] Find another one AudioSpecificConfig\"),debug.error(2<=k.length,\"[AAC] AudioSpecificConfig parse length is not enough\");var l={};l.audioObjectType=(248&k[0])>>3,l.samplingFrequencyIndex=((7&k[0])<<1)+(1&(128&k[1])>>7),l.channelConfiguration=(127&k[1])>>3,AudioSpecificConfig=l,postMessage({type:\"AudioSpecificConfig\",data:l})}else{var e=AudioSpecificConfig,f=e.audioObjectType,g=e.samplingFrequencyIndex,h=e.channelConfiguration,i=a.dataSize-2+7,j=new Uint8Array(7);j[0]=255,j[1]=240,j[1]|=0,j[1]|=0,j[1]|=1,j[2]=f-1<<6,j[2]|=(15&g)<<2,j[2]|=0,j[2]|=(4&h)>>2,j[3]=(3&h)<<6,j[3]|=0,j[3]|=0,j[3]|=0,j[3]|=0,j[3]|=(6144&i)>>11,j[4]=(2040&i)>>3,j[5]=(7&i)<<5,j[5]|=31,j[6]=252;var m=a.body.subarray(2);postMessage({type:\"audioData\",data:mergeBuffer(j,m),timestamp:a.timestamp})}}onmessage=function onmessage(a){if(uint8=mergeBuffer(uint8,a.data),!header&&readable(13)){header=Object.create(null),header.signature=readString(read(3)),header.version=read(1)[0],debug.error(\"FLV\"===header.signature&&1===header.version,\"FLV header not found\"),header.flags=read(1)[0];var b=0!=(4&header.flags)>>>2,c=0!=(1&header.flags);debug.warn(c,\"[FLV header] flags not found video\"),debug.warn(b,\"[FLV header] flags not found audio\"),header.headersize=readBufferSum(read(4));var j=readBufferSum(read(4));debug.error(0===j,\"PrevTagSize0 should be equal to 0, but got \".concat(j)),postMessage({type:\"flvHeader\",data:header})}for(;index<uint8.length;){var d=Object.create(null),e=index;if(readable(11)){d.tagType=read(1)[0],d.dataSize=readBufferSum(read(3));var f=read(1)[0],g=read(1)[0],h=read(1)[0],i=read(1)[0];d.timestamp=h|g<<8|f<<16|i<<24,d.streamID=readBufferSum(read(3)),debug.error(0===d.streamID,\"streamID should be equal to 0, but got \".concat(d.streamID))}else return index=0,void(uint8=uint8.subarray(e));if(readable(d.dataSize+4)){d.body=read(d.dataSize);var k=readBufferSum(read(4));debug.error(k===d.dataSize+11,\"Invalid PrevTagSize: \".concat(k))}else return index=0,void(uint8=uint8.subarray(e));switch(d.tagType){case 18:demuxerScripTag(d);break;case 9:demuxerVideoTag(d);break;case 8:demuxerAudioTag(d);break;default:debug.error(!1,\"unknown tag type: \".concat(d.tagType));}}index=0,uint8=new Uint8Array};"]))),this.demuxRate=A(function(e){t.emit("demuxRate",e)}),t.on("destroy",function(){r.demuxWorker.terminate(),r.demuxWorker=null}),t.on("streamStart",function(){if(r.streaming=!0,r.streamStartTime=k(),"string"==typeof n.url){var e=Object.assign(document.createElement("a"),{href:n.url}).href;a.log("stream-url",e)}}),t.on("streaming",function(e){r.demuxWorker.postMessage(e)}),t.on("streamEnd",function(e){r.streaming=!1,r.streamEndTime=k(),e&&(r.index=0,r.demuxWorker.postMessage(e)),a.log("stream-time","".concat(r.streamEndTime-r.streamStartTime," ms")),r.demuxed=!0,t.emit("demuxDone"),a.log("demux-done")});var o=new Uint8Array,i=new Uint8Array;this.demuxWorker.onmessage=function(e){var n=e.data;switch(n.type){case"flvHeader":r.header=n.data,t.emit("flvHeader",r.header),a.log("flv-header",r.header);break;case"scripMeta":r.scripMeta=n.data,t.emit("scripMeta",r.scripMeta),a.log("scrip-meta",r.scripMeta);break;case"AVCDecoderConfigurationRecord":r.AVCDecoderConfigurationRecord=n.data,t.emit("AVCDecoderConfigurationRecord",r.AVCDecoderConfigurationRecord),a.log("AVCDecoderConfigurationRecord",r.AVCDecoderConfigurationRecord),a.log("AVC-codecs",R(r.AVCDecoderConfigurationRecord)),a.log("AVC-profile",_(r.AVCDecoderConfigurationRecord.AVCProfileIndication)),a.log("AVC-level",E(r.AVCDecoderConfigurationRecord.AVCLevelIndication));break;case"AudioSpecificConfig":r.AudioSpecificConfig=n.data,t.emit("AudioSpecificConfig",r.AudioSpecificConfig),a.log("AudioSpecificConfig",r.AudioSpecificConfig),a.log("AAC-codecs",B(r.AudioSpecificConfig));break;case"videoData":{r.demuxRate(1),r.videoDataLength+=1,r.videoDataSize+=n.data.byteLength;var d=h(n.data);d(4);var c=31&d(1)[0];switch(c){case 1:case 5:{t.emit("videoData",v(o,i,n.data),n.timestamp);break}case 7:o=n.data;break;case 8:i=n.data;break;default:}break}case"audioData":r.audioDataLength+=1,r.audioDataSize+=n.data.byteLength,t.emit("audioData",n.data,n.timestamp);break;default:}}},pe=/*#__PURE__*/function(){function e(t){var r=this;H(this,e),this.flv=t;var n=t.options,a=t.player,o=t.debug;this.byteLength=0,this.reader=null,this.chunkStart=0,this.contentLength=0,this.data=new Uint8Array,this.readChunk=S(this.readChunk,1e3),this.chunkSize=n.hasAudio?n.videoChunk+n.audioChunk:n.videoChunk,this.streamRate=A(function(e){t.emit("streamRate",e)}),t.on("destroy",function(){r.reader&&r.reader.cancel(),r.data=null}),t.on("timeupdate",function(e){!n.live&&5>=a.loaded-e&&r.readChunk()}),d()?(o.log("stream-type","Try use ReadableStream"),this.initFetchStream()):(o.log("stream-type","Try use http headers range"),fetch(n.url,{method:"head",credentials:n.withCredentials?"include":"omit",mode:n.cors?"cors":"no-cors"}).then(function(e){r.contentLength=+e.headers.get("content-length")||n.filesize,o.log("stream-contentLength",r.contentLength),r.flv.emit("streamStart"),r.initFetchRange(0,r.chunkSize)}).catch(function(e){throw t.emit("streamError",e),e}))}return N(e,[{key:"readChunk",value:function(){var e=z(this.chunkStart+this.chunkSize,this.data.length);if(e>this.chunkStart){var t=this.data.subarray(this.chunkStart,e);this.flv.emit("streaming",t),this.chunkStart=e}}},{key:"initFetchStream",value:function(){var e=this,t=this.flv,r=t.options,n=t.debug;return this.flv.emit("streamStart"),fetch(r.url,{credentials:r.withCredentials?"include":"omit",mode:r.cors?"cors":"no-cors",headers:r.headers}).then(function(t){return t.body&&"function"==typeof t.body.getReader?(e.reader=t.body.getReader(),function e(){var t=this;return this.reader.read().then(function(a){var o=a.done,i=a.value;if(o)return t.flv.emit("streamEnd"),n.log("stream-end","".concat(t.byteLength," byte")),null;var d=new Uint8Array(i);return t.byteLength+=d.byteLength,t.streamRate(d.byteLength),r.live?t.flv.emit("streaming",d):(t.data=v(t.data,d),0===t.chunkStart&&t.data.length>=t.chunkSize&&t.readChunk()),e.call(t)}).catch(function(e){throw t.flv.emit("streamError",e),e})}.call(e)):(n.log("stream-type","Try use response arrayBuffer"),t.arrayBuffer())}).then(function(t){t&&t.byteLength&&!r.live&&(e.data=new Uint8Array(t),e.byteLength+=e.data.byteLength,e.flv.emit("streamEnd",e.data),n.log("stream-end","".concat(e.byteLength," byte")))}).catch(function(t){throw e.flv.emit("streamError",t),t})}},{key:"initFetchRange",value:function(e,t){var r=this,n=this.flv.options;return fetch(n.url,{credentials:n.withCredentials?"include":"omit",mode:n.cors?"cors":"no-cors",headers:M({},n.headers,{range:"bytes=".concat(e,"-").concat(t)})}).then(function(e){return e.arrayBuffer()}).then(function(e){var a=new Uint8Array(e);r.byteLength+=a.byteLength,r.streamRate(a.byteLength),n.live?r.flv.emit("streaming",a):(r.data=v(r.data,a),0===r.chunkStart&&r.data.length>=r.chunkSize&&r.readChunk());var o=z(r.contentLength,t+1),i=z(r.contentLength,o+r.chunkSize);i>o&&r.initFetchRange(o,i)}).catch(function(e){throw r.flv.emit("streamError",e),e})}}]),e}(),me=function e(t){var r=this;H(this,e);var n=t.debug,a=t.options,o=t.events.proxy;this.byteLength=0,this.streamRate=A(function(e){t.emit("streamRate",e)}),this.socket=new WebSocket(t.options.url),this.socket.binaryType="arraybuffer",t.emit("streamStart"),o(this.socket,"open",function(){r.socket.send(a.socketSend)}),o(this.socket,"message",function(e){var n=new Uint8Array(e.data);r.byteLength+=n.byteLength,r.streamRate(n.byteLength),t.emit("streaming",n)}),o(this.socket,"close",function(){t.emit("streamEnd"),n.log("stream-end","".concat(r.byteLength," byte"))}),o(this.socket,"error",function(e){throw t.emit("streamError",e),e}),t.on("destroy",function(){r.socket.close()})},ge=function e(t){H(this,e);var r=new FileReader,n=t.events.proxy;n(r,"load",function(r){var e=new Uint8Array(r.target.result);t.emit("streamEnd",e),t.debug.log("stream-end","".concat(e.byteLength," byte"))}),n(r,"error",function(e){t.emit("streamError",e)}),t.on("destroy",function(){r.abort()}),t.emit("streamStart"),r.readAsArrayBuffer(t.options.url)},ye=/*#__PURE__*/function(){function e(t){H(this,e);var r=e.getLoaderFactory(t.options.url);return t.debug.log("stream-loader",r.name),new r(t,this)}return N(e,null,[{key:"getLoaderFactory",value:function(e){return e instanceof File?ge:/^ws{1,2}:\/\//i.test(e)?me:pe}}]),e}(),be=0,he=/*#__PURE__*/function(e){function t(e){var r;return H(this,t),r=J(this,X(t).call(this)),r.options=K(I({},t.options,{},e),t.scheme),r.options.live&&(r.options.cache=!1),"string"==typeof r.options.container&&(r.options.container=document.querySelector(r.options.container)),window.FlvplayerDecoder?r.init():C(r.options.decoder,"FlvplayerDecoder").then(function(){r.init()}),console.log("%c FlvPlayer.js %c 1.1.4 %c https://flvplayer.js.org","color: #fff; background: #5f5f5f","color: #fff; background: #4bc729",""),r}return Z(t,e),N(t,[{key:"init",value:function(){this.isDestroy=!1,this.isMobile=g(),this.isWechat=y(),this.debug=new oe(this),this.events=new ie(this),this.player=new ce(this),this.decoder=new le(this),this.demuxer=new fe(this),this.stream=new ye(this),w(this,this.player),window.FlvplayerControl&&this.options.control&&(this.control=new window.FlvplayerControl(this),w(this,this.control)),be+=1,this.id=be,t.instances.push(this)}},{key:"destroy",value:function(){this.isDestroy=!0,this.emit("destroy"),t.instances.splice(t.instances.indexOf(this),1)}}],[{key:"options",get:function(){return{url:"",container:"",poster:"",debug:!1,live:!1,loop:!1,autoPlay:!1,hasAudio:!0,control:!0,cache:!0,muted:!1,cors:!0,touchResume:!0,withCredentials:!1,volume:.7,frameRate:30,maxTimeDiff:200,videoChunk:1048576,audioChunk:16384,filesize:1/0,width:400,height:300,duration:0,socketSend:"",headers:{},decoder:"./flvplayer-decoder-baseline.js"}}},{key:"scheme",get:function(){return{url:"string|file",container:"string|htmldivelement",poster:"string",debug:"boolean",live:"boolean",loop:"boolean",autoPlay:"boolean",hasAudio:"boolean",control:"boolean",cache:"boolean",muted:"boolean",cors:"boolean",touchResume:"boolean",withCredentials:"boolean",volume:"number",frameRate:"number",maxTimeDiff:"number",videoChunk:"number",audioChunk:"number",filesize:"number",width:"number",height:"number",duration:"number",socketSend:"string",headers:"object",decoder:"string"}}},{key:"isSupported",get:function(){return p}},{key:"version",get:function(){return"1.1.4"}},{key:"env",get:function(){return"\"production\""}},{key:"utils",get:function(){return de}}]),t}(ee);return Object.defineProperty(he,"instances",{value:[]}),he});
